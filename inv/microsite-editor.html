<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Microsite - Epistecnología</title>
    
    <link rel="icon" type="image/png" href="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png">
    <link rel="stylesheet" href="/inv/css/style-editor.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tiny.cloud/1/wac03ii8izevsozn0if0ssfme0syw62i0zw7szp05f8trx3o/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
</head>
<body>

    <header class="editor-main-header">
        <a href="/inv/dashboard.html" class="header-logo">
            <img src="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png" alt="Logo">
            <span>Editor Visual</span>
        </a>
        <nav class="header-nav">
            <a href="/inv/dashboard.html"><i class="fa-solid fa-table-columns"></i> Dashboard</a>
            <button id="preview-btn-header" class="btn-header-secondary"><i class="fa-solid fa-eye"></i> Previsualizar</button>
            <button id="save-btn-header" class="btn-header-primary"><i class="fa-solid fa-cloud-arrow-up"></i> Publicar Cambios</button>
        </nav>
    </header>

    <div class="editor-container">
        <div class="editor-panel">
            <div class="editor-hero">
                <h1>Construye tu Legado</h1>
                <p>Diseña la experiencia inmersiva de tu proyecto científico.</p>
            </div>

            <form id="microsite-form">
                
                <fieldset class="builder-section">
                    <legend><i class="fa-solid fa-image text-accent"></i> 1. Impacto Visual (Portada)</legend>
                    
                    <div class="form-group">
                        <label for="cover-headline">Titular Principal:</label>
                        <div class="input-with-ai">
                            <input type="text" id="cover-headline" placeholder="Un titular breve y potente...">
                            <button type="button" class="ai-button" data-target="cover-headline" title="Generar Título con IA"><i class="fa-solid fa-wand-magic-sparkles"></i></button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cover-image-url">Imagen de Fondo (Cinemática):</label>
                        <div class="input-with-upload">
                            <input type="text" id="cover-image-url" placeholder="Sube una imagen o pega una URL...">
                            <input type="file" id="file-cover-image" accept="image/*" style="display:none;">
                            <button type="button" class="btn-upload" onclick="document.getElementById('file-cover-image').click()"><i class="fa-solid fa-cloud-arrow-up"></i> Subir</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="seo-image-url">Miniatura para Redes Sociales (SEO):</label>
                        <div class="input-with-upload">
                            <input type="text" id="seo-image-url" placeholder="Imagen que se verá al compartir en WhatsApp/Bluesky...">
                            <input type="file" id="file-seo-image" accept="image/*" style="display:none;">
                            <button type="button" class="btn-upload" onclick="document.getElementById('file-seo-image').click()"><i class="fa-solid fa-cloud-arrow-up"></i> Subir</button>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="builder-section">
                    <legend><i class="fa-solid fa-bullseye text-accent"></i> 2. La Esencia (Resumen)</legend>
                    <div class="form-group">
                        <div class="flex-between">
                            <label for="summary-content">Contenido del Proyecto:</label>
                            <button type="button" class="ai-button-text" id="ai-rewrite-summary" title="Simplificar y mejorar redacción con IA"><i class="fa-solid fa-wand-magic-sparkles"></i> Mejorar con IA</button>
                        </div>
                        <textarea id="summary-content" class="tinymce-editor" placeholder="Desarrolla la idea central de tu investigación..."></textarea>
                    </div>
                </fieldset>

                <fieldset class="builder-section readonly-section">
                    <legend><i class="fa-solid fa-database text-accent"></i> 3. Datos Sincronizados</legend>
                    <p class="form-hint mb-3">Estos datos se extraen automáticamente de tu base de datos central.</p>
                    
                    <div class="sync-grids" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem;">
                        <div class="sync-col">
                            <h5><i class="fa-solid fa-users"></i> Equipo</h5>
                            <div id="researchers-preview-container" class="preview-grid mini-grid"></div>
                        </div>
                        <div class="sync-col">
                            <h5><i class="fa-solid fa-video"></i> Sesiones</h5>
                            <div id="sessions-preview-container" class="preview-grid mini-grid"></div>
                        </div>
                        <div class="sync-col">
                            <h5><i class="fa-solid fa-newspaper"></i> Artículos Públicos</h5>
                            <div id="posts-preview-container" class="preview-grid mini-grid"></div>
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label for="associated-event-select">Asignar Evento Principal:</label>
                        <select id="associated-event-select" class="modern-select">
                            <option value="">-- Ningún evento asociado --</option>
                        </select>
                    </div>
                </fieldset>

                <fieldset class="builder-section">
                    <legend><i class="fa-solid fa-cubes text-accent"></i> 4. Constructor de Módulos</legend>
                    <p class="form-hint mb-3">Añade bloques de contenido y usa las flechas (↑ ↓) para ordenar cómo se verán en la página.</p>
                    
                    <div id="custom-modules-container" class="modules-canvas"></div>
                    
                    <div class="module-actions-bar">
                        <span>Añadir bloque:</span>
                        <button type="button" class="btn-add-mod" data-type="text"><i class="fa-solid fa-align-left"></i> Texto</button>
                        <button type="button" class="btn-add-mod" data-type="embed"><i class="fa-solid fa-play"></i> Media (Video)</button>
                        <button type="button" class="btn-add-mod" data-type="subscription"><i class="fa-solid fa-envelope"></i> Suscripción</button>
                        <button type="button" class="btn-add-mod" data-type="sponsors"><i class="fa-solid fa-handshake"></i> Apoyos</button>
                        <button type="button" class="btn-add-mod" data-type="timeline"><i class="fa-solid fa-stream"></i> Hitos</button>
                    </div>
                </fieldset>

                <fieldset class="builder-section bg-light-panel">
                    <legend><i class="fa-solid fa-gear text-accent"></i> 5. Configuración de Lanzamiento</legend>
                    
                    <div class="settings-grid">
                        <div class="setting-box">
                            <label>Diseño y Tema</label>
                            <select id="template-style-select" class="modern-select mb-2">
                                <option value="modern">Moderna (Inmersiva)</option>
                                <option value="classic">Clásica (Bento Estándar)</option>
                            </select>
                            <select id="color-palette-select" class="modern-select">
                                <option value="dark">Cinemático (Oscuro)</option>
                                <option value="default">Agencia (Claro)</option>
                                <option value="sand">Académico (Arena)</option>
                            </select>
                        </div>

                        <div class="setting-box">
                            <label>Enlace del Proyecto (Slug)</label>
                            <div class="slug-editor">
                                <span class="slug-prefix">epistecnologia.com/p/</span>
                                <input type="text" id="project-slug" placeholder="mi-proyecto-increible">
                            </div>
                            <p class="form-hint" style="font-size:0.75rem; margin-top:5px;">Usa solo letras minúsculas, números y guiones medios (-).</p>
                        </div>

                        <div class="setting-box flex-center-col">
                            <label style="text-align:center;">Estado del Microsite</label>
                            <label class="switch modern-switch">
                                <input type="checkbox" id="microsite-is-public">
                                <span class="slider round"></span>
                            </label>
                            <span id="public-status-text" class="status-text mt-2">Borrador Privado</span>
                        </div>
                    </div>
                </fieldset>

            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/inv/js/microsite-editor.js"></script>
</body>
</html>