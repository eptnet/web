<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Epistecnología</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="/inv/css/dashboard.css">
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="sidebar__header">
                <a href="/" class="sidebar__logo-link">
                    <img src="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png" alt="Logo" class="sidebar__logo-img">
                    <span class="sidebar__logo-text">Epistecnología</span>
                </a>
            </div>
            <nav class="sidebar__nav">
                <a href="#home" class="sidebar__link active" data-section="home-section" title="Inicio">
                    <i class="fa-solid fa-house"></i>
                    <span class="sidebar__link-text">Inicio</span>
                </a>
                <a href="#creator-studio" class="sidebar__link" data-section="creator-studio-section" title="Crear Textos">
                    <i class="fa-solid fa-magic-sparkles"></i>
                    <span class="sidebar__link-text">Crear Textos</span>
                </a>
                <a href="#studio" class="sidebar__link" data-section="studio-section" title="Estudio de Grabación">
                    <i class="fa-solid fa-podcast"></i>
                    <span class="sidebar__link-text">Estudio</span>
                </a>
                <a href="#profile" class="sidebar__link" data-section="profile-section" title="Editar Perfil">
                    <i class="fa-solid fa-user-edit"></i>
                    <span class="sidebar__link-text">Mi Perfil</span>
                </a>
                 <a href="#services" class="sidebar__link" data-section="services-section" title="Servicios">
                    <i class="fa-solid fa-briefcase"></i>
                    <span class="sidebar__link-text">Servicios</span>
                </a>
            </nav>
            <div class="sidebar__footer">
                 <a href="#" id="logout-btn" class="sidebar__link" title="Cerrar Sesión">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span class="sidebar__link-text">Cerrar Sesión</span>
                </a>
            </div>
        </aside>

        <div class="dashboard__body">
            <header class="top-header">
                <div class="top-header__welcome">
                    <h1 id="user-name-header">Bienvenido</h1>
                    <p>Empecemos a divulgar tu conocimiento.</p>
                </div>
                <div class="top-header__actions">
                    <div class="search-bar">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="search" placeholder="Buscar...">
                    </div>
                    <button class="action-btn" title="Notificaciones"><i class="fa-solid fa-bell"></i></button>
                    <div class="user-menu">
                        <img id="user-avatar" src="https://i.ibb.co/61fJv24/default-avatar.png" alt="Avatar de usuario">
                    </div>
                </div>
            </header>

            <main class="main-content">
                <div id="dashboard-main-view">
                    <section id="home-section" class="content-section active"></section>
                    <section id="creator-studio-section" class="content-section"></section>
                    <section id="studio-section" class="content-section"></section>
                    <section id="profile-section" class="content-section"></section>
                    <section id="services-section" class="content-section"></section>
                </div>

                <div id="mixer-embed-container" class="mixer-embed-container" style="display: none;">
                    <div class="mixer-embed__header">
                        <h3><i class="fa-solid fa-sliders"></i> Sala de Control</h3>
                        <div class="mixer-embed__actions">
                            <button id="mixer-popout-btn" class="btn-secondary" title="Abrir en nueva pestaña"><i class="fa-solid fa-arrow-up-right-from-square"></i></button>
                            <button id="mixer-close-btn" class="btn-secondary" title="Cerrar Sala de Control">&times;</button>
                        </div>
                    </div>
                    <div class="mixer-embed__content">
                        <iframe id="mixer-iframe" allow="autoplay; camera; microphone; fullscreen; picture-in-picture; display-capture"></iframe>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="project-modal-overlay" class="modal-overlay"></div>
    <div id="studio-modal-overlay" class="modal-overlay"></div>
    
    <template id="template-home">
        <div class="workflow-step">
            <div class="step-header"><h2><span class="step-number">1</span> Selecciona tu Proyecto</h2></div>
            <p>Elige el trabajo de investigación que quieres divulgar hoy.</p>
            <div class="project-selector">
                <select id="project-dropdown" class="input-field"></select>
                <button class="btn-primary" id="add-project-btn"><i class="fa-solid fa-plus"></i> Registrar Nuevo</button>
            </div>
        </div>
        <div class="workflow-step">
            <div class="step-header"><h2><span class="step-number">2</span> ¿Cómo quieres divulgar hoy?</h2></div>
            <p>Elige una herramienta para transformar tu investigación.</p>
            <div class="creation-grid">
                <div class="creation-card" data-target-section="creator-studio-section"><i class="fa-solid fa-file-pen icon"></i><h3>Generar Textos Sociales</h3><p>Transforma un texto denso en un artículo de blog y posts para redes sociales.</p></div>
                <div class="creation-card" data-target-section="studio-section"><i class="fa-solid fa-video icon"></i><h3>Crear Video o Podcast</h3><p>Grábate solo o con invitados, en formato de video o solo audio.</p></div>
            </div>
        </div>
    </template>
    
    <template id="template-profile">
        <h2>Tu Perfil Público</h2>
        <p>Esta información podrá ser mostrada en tus transmisiones y publicaciones.</p>
        <form id="profile-form" class="profile-form">
            <div class="form-group"><label for="display-name">Nombre a Mostrar</label><input type="text" id="display-name" class="input-field" placeholder="Ej: Dra. Ada Lovelace"></div>
            <div class="form-group"><label for="bio">Biografía Corta</label><textarea id="bio" rows="4" class="input-field" placeholder="Ej: Pionera en computación..."></textarea></div>
            <div class="form-group"><label for="orcid-url">URL de tu ORCID</label><input type="url" id="orcid-url" class="input-field" placeholder="https://orcid.org/0000-0000-0000-0000" required></div>
            <button type="submit" class="btn-primary"><span class="btn-text">Guardar Cambios</span></button>
            <p id="profile-form-message" class="form-message"></p>
        </form>
    </template>

    <template id="template-studio">
         <h2>Estudio de Grabación y Transmisión</h2>
         <p>Tu centro de control para crear contenido audiovisual.</p>
         <div class="studio-launcher">
             <div class="launcher-icon"><i class="fa-solid fa-podcast"></i></div>
             <h3>Crea tu Sala Personalizada</h3>
             <p>Genera una sala de grabación o transmisión en vivo. Invita colegas, comparte tu pantalla y mucho más.</p>
             <button class="btn-primary" id="open-studio-modal-btn"><i class="fa-solid fa-plus"></i> Crear Nueva Sala</button>
         </div>
    </template>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        window.firebase = { initializeApp, getFirestore, doc, getDoc, setDoc, arrayUnion };
    </script>
    <script type="module" src="/inv/js/dashboard.js"></script>
</body>
</html>