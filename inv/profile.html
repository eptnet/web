<!DOCTYPE html>
<html lang="es">
<head>
     <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MBEXC7T1EF"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-MBEXC7T1EF');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Epistecnología</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/inv/css/profile.css">
</head>
<body class="loading-profile">

    <header class="desktop-nav">
        <div class="container">
            <a href="/" class="logo"><img src="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png" alt="Epistecnologia Logo"></a>
            <nav class="main-menu bento-box-nav">
                <a href="/" class="nav-icon" aria-label="Inicio"><i class="fa-solid fa-house"></i></a>
                <a href="https://eptnews.substack.com/" class="nav-icon" aria-label="Newsletter"><i class="fa-solid fa-newspaper"></i></a>
                <a href="/inv/comunidad.html" class="nav-icon" aria-label="Comunidad"><i class="fa-solid fa-users"></i></a>
            </nav>
            <div class="live-channels bento-box-nav">
                <a href="/live.html" class="nav-icon" id="nav-live-desktop" aria-label="En Vivo"><i class="fa-solid fa-satellite-dish"></i></a>
                <a href="/live.html#seccion-eventos" class="nav-icon" aria-label="Eventos"><i class="fa-solid fa-calendar-days"></i></a>
                <a href="#" class="nav-icon" id="notifications-bell-icon" aria-label="Notificaciones"><i class="fa-solid fa-bell"></i></a>
            </div>
            <div class="user-actions bento-box-nav">
                <div id="guest-view">
                    <button id="login-modal-trigger" class="nav-icon" aria-label="Iniciar sesión"><i class="fa-solid fa-user"></i></button>
                </div>
                <div id="user-view" style="display: none;">
                    <a href="/inv/profile.html" id="user-avatar-link" class="nav-icon active" title="Mi Perfil"></a>
                    <button id="logout-btn-header" class="nav-icon" title="Cerrar Sesión"><i class="fa-solid fa-right-from-bracket"></i></button>
                </div>
                <button class="theme-switcher nav-icon" id="theme-switcher-desktop" aria-label="Cambiar tema"><i class="fa-solid fa-moon"></i></button>
            </div>
        </div>
    </header>

    <div class="page-container">
        <div class="profile-layout">
            <aside class="profile-sidebar">
                <div class="bento-box profile-card">
                    <img id="profile-card-avatar" class="profile-card__avatar" alt="Avatar de usuario">
                    <h2 id="profile-card-name">Cargando...</h2>
                    <p id="profile-card-orcid" class="profile-card__orcid"></p>
                    <p id="profile-card-bio"></p>
                    <div id="profile-card-socials" class="profile-card__socials"></div>
                    <hr>
                    <div id="sidebar-buttons-container" class="profile-card-nav"></div>
                </div>
                
            </aside>

            <main class="main-content">
                <nav class="profile-tabs">
                    <button class="profile-tab-link active" data-tab="tab-perfil"><i class="fa-solid fa-user-pen"></i> <span>Perfil</span></button>
                    <button class="profile-tab-link" data-tab="tab-identidad"><i class="fa-brands fa-orcid"></i> <span>ID Académico</span></button>
                    <button class="profile-tab-link" data-tab="tab-proyectos"><i class="fa-solid fa-cloud-arrow-up"></i> <span>EPT DOI</span></button>
                    <button class="profile-tab-link" data-tab="tab-comunidad"><i class="fa-solid fa-comments"></i> <span>Comunidad</span></button>
                </nav>

                <div id="tab-perfil" class="profile-tab-content active">
                    <div class="main-column">
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-user-pen"></i> Perfil Público</h3>

                            <div class="view-mode">
                                <div class="profile-view-group">
                                    <label>Nombre a Mostrar</label>
                                    <p id="view-display-name">Cargando...</p>
                                </div>
                                <div class="profile-view-group">
                                    <label>Nombre de Autor (para publicaciones)</label>
                                    <p id="view-substack-author-name">No establecido</p>
                                </div>
                                <div class="profile-view-group">
                                    <label>Biografía Corta</label>
                                    <p id="view-bio">Cargando...</p>
                                </div>
                                <button class="btn btn-secondary edit-btn" style="width: auto; margin-top: 1rem;">
                                    <i class="fa-solid fa-pencil"></i> Editar
                                </button>
                            </div>

                            <div class="edit-mode" style="display: none;">
                                <form id="profile-form">
                                    <div class="form-group">
                                        <label for="display-name">Nombre a Mostrar</label>
                                        <input type="text" id="display-name" name="display_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="substack-author-name">Nombre de Autor (Substack)</label>
                                        <input type="text" id="substack-author-name" name="substack_author_name" placeholder="Tu nombre exacto como aparece en Substack" required>
                                        <span class="form-hint" style="margin-top: 0.5rem; display: block;">Este nombre se usará para vincular tus publicaciones.</span>
                                    </div>
                                    <div class="form-group">
                                        <label for="bio">Biografía Corta (250 caracteres)</label>
                                        <textarea id="bio" name="bio" rows="3" maxlength="250"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa-solid fa-floppy-disk"></i> Guardar Perfil
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="bento-box">
                            <h3><i class="fa-solid fa-share-nodes"></i> Plataformas y Redes</h3>

                            <div class="view-mode">
                                <div id="view-platforms-list" class="platforms-view-list">
                                    <p class="form-hint">No hay plataformas configuradas.</p>
                                </div>
                                <button class="btn btn-secondary edit-btn" style="width: auto; margin-top: 1rem;">
                                    <i class="fa-solid fa-pencil"></i> Editar
                                </button>
                            </div>

                            <div class="edit-mode" style="display: none;">
                                <form id="platforms-form">
                                    <h4>Plataformas Principales</h4>
                                    <div class="form-group">
                                        <label for="youtube-url">Canal de YouTube</label>
                                        <input type="url" id="youtube-url" name="youtube_url" placeholder="https://youtube.com/@tucanal">
                                    </div>
                                    <div class="form-group">
                                        <label for="substack-url">Perfil de Substack</label>
                                        <input type="url" id="substack-url" name="substack_url" placeholder="https://tunombre.substack.com">
                                        <span id="substack-verification-status" class="form-hint" style="margin-top: 0.5rem; display: block;"></span>
                                    </div>
                                    <div class="form-group">
                                        <label for="bsky-url">Perfil de Bluesky</label>
                                        <input type="url" id="bsky-url" name="bsky_url" placeholder="https://bsky.app/profile/usuario.bsky.social">
                                    </div>
                                    <hr>
                                    <h4>Otras Redes Sociales</h4>
                                    <div class="form-group">
                                        <label for="website-url">Sitio Web / Blog</label>
                                        <input type="url" id="website-url" name="website_url" placeholder="https://...">
                                    </div>
                                    <div class="form-group">
                                        <label for="x-url">Perfil de X (Twitter)</label>
                                        <input type="url" id="x-url" name="x_url" placeholder="https://x.com/usuario">
                                    </div>
                                    <div class="form-group">
                                        <label for="linkedin-url">Perfil de LinkedIn</label>
                                        <input type="url" id="linkedin-url" name="linkedin_url" placeholder="https://linkedin.com/in/usuario">
                                    </div>
                                    <div class="form-group">
                                        <label for="instagram-url">Perfil de Instagram</label>
                                        <input type="url" id="instagram-url" name="instagram_url" placeholder="https://instagram.com/usuario">
                                    </div>
                                    <div class="form-group">
                                        <label for="facebook-url">Perfil de Facebook</label>
                                        <input type="url" id="facebook-url" name="facebook_url" placeholder="https://facebook.com/usuario">
                                    </div>
                                    <div class="form-group">
                                        <label for="tiktok-url">Perfil de TikTok</label>
                                        <input type="url" id="tiktok-url" name="tiktok_url" placeholder="https://tiktok.com/@usuario">
                                    </div>
                                </br>
                                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Guardar Plataformas</button>
                                </form>
                            </div>
                        </div>
                        
                    </div>

                    <div class="side-column">
                        <div class="bento-box">
                            <h3><i class="fa-brands fa-orcid"></i> Verificación de Investigador</h3>
                            <p class="form-hint">Conecta tu cuenta de ORCID para ser verificado y desbloquear funcionalidades avanzadas, como la publicación de contenido.</p>
                            <div id="orcid-section" style="margin-top: 1rem;"></div>
                        </div>
                        
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-camera"></i> Avatar</h3>
                            <p class="form-hint">Pega aquí el enlace directo (URL.jpg) de tu imagen de perfil. Puedes usar un servicio como <a href="https://imgbb.com/" target="_blank">imgbb.com</a>.</p>
                            <form id="avatar-update-form">
                                <div class="form-group"><label for="avatar-url">URL de la imagen del perfil</label><input type="url" id="avatar-url" placeholder="https://i.ibb.co/...tu-imagen.jpg" required></div>
                                <button type="submit" class="btn btn-secondary"><i class="fa-solid fa-floppy-disk"></i> Guardar Avatar</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="tab-identidad" class="profile-tab-content">
                    <div class="main-column">
                        <div class="bento-box">
                            <h3><i class="fa-brands fa-orcid"></i> Publicaciones Sincronizadas</h3>
                            <p class="form-hint">Aquí se encuentran listados tus proyectos (DOI) sincronizados desde tu ORCID y los que podrás sellecionar para la creación de contenidos.</p>
                            <div id="projects-list" class="projects-list"></div>
                        </div>
                    </div>
                    <div class="side-column">
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-book-bookmark"></i> Sincronizar Proyectos</h3>
                            <div id="projects-section">
                                <p class="form-hint">Una vez conectado a ORCID, podrás sincronizar tus trabajos.</p>
                                <button id="sync-orcid-works-btn" class="btn btn-secondary" disabled>
                                    <i class="fa-solid fa-sync"></i> Sincronizar desde ORCID
                                </button>
                                <p id="sync-hint" class="form-hint" style="margin-top: 0.75rem; color: var(--color-accent); display: none;">
                                    Necesitas conectar tu ORCID en la pestaña "Perfil" para poder sincronizar.
                                </p>
                            </div>
                        </div>
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-comments"></i> Publicar en la Comunidad</h3>
                            <p class="form-hint">Como investigador verificado, puedes conectar tu cuenta para publicar directamente desde Epistecnología.</p>
                            <div id="bsky-status-container" style="margin-top: 1rem;"></div>
                        </div>
                    </div>
                </div>

                <div id="tab-proyectos" class="profile-tab-content">
                    <div class="main-column">
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-cloud-arrow-up"></i> Obtener DOI en Zenodo EPT</h3>
                            <form id="zenodo-form">
                                <div class="form-group"><label for="zenodo-title">Título de la Publicación</label><input type="text" id="zenodo-title" required></div>
                                <div class="form-group"><label for="zenodo-description">Descripción / Abstract</label><textarea id="zenodo-description" rows="4" required></textarea></div>
                                <div class="form-group"><label for="zenodo-file">Archivo a Publicar (PDF, ZIP, etc.)</label><input type="file" id="zenodo-file" required></div>
                                <button type="submit" class="btn btn-primary">Publicar y Obtener DOI</button>
                                <div id="zenodo-message" class="form-message" style="margin-top: 1rem;"></div>
                            </form>
                        </div>
                    </div>
                    <div class="side-column">
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-circle-info"></i> ¿Cómo Funciona?</h3>
                            <div class="instructions-content">
                                <p>Al publicar desde aquí, tu trabajo se sube a la comunidad oficial de Epistecnología en Zenodo, obteniendo un DOI citable a tu nombre.</p>
                            </div>
                        </div>
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-th-list"></i> Tus Publicaciones EPT DOI</h3>
                            <div id="ept-doi-list">
                                <p class="form-hint">Aquí aparecerán los proyectos que publiques a través de esta herramienta.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-comunidad" class="profile-tab-content">
                    <div class="main-column">
                        <div class="bento-box">
                            <h3><i class="fa-solid fa-comments"></i> Comunidad Epistecnología</h3>
                            <div id="community-feed-container" style="margin-top: 1rem;">
                                </div>
                        </div>
                    </div>
                    <div class="side-column">
                        <div class="bento-box">
                            <h3>Participa</h3>
                            <div id="community-action-panel">
                                </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <div id="modal-container"></div>
    
    <template id="bsky-connect-template">
        <div class="bento-box">
            <h3><i class="fa-solid fa-link"></i> Conectar Cuenta para Participar</h3>
            
            <div class="step">
                <h4>Paso 1: Ten una cuenta de Bluesky</h4>
                <p class="form-hint">Para interactuar necesitas una cuenta en la red social descentralizada Bluesky. Si no tienes una, ¡es gratis y fácil de crear!</p>
                <a href="https://bsky.app" target="_blank" class="btn btn-secondary" style="width:100%; text-decoration: none;">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> Crear o Iniciar Sesión en Bluesky
                </a>
            </div>
            
            <hr>

            <div class="step">
                <h4>Paso 2: Conecta de Forma Segura</h4>
                <p class="form-hint">Genera una <strong>Contraseña de Aplicación</strong> (no tu contraseña principal) para darnos permiso de publicar en tu nombre.</p>
                <form id="bsky-connect-form">
                    <div class="form-group">
                        <label for="bsky-handle">Tu Handle de Bluesky</label>
                        <input type="text" id="bsky-handle" placeholder="tu-usuario.bsky.social" required>
                    </div>
                    <div class="form-group">
                        <label for="bsky-app-password">Contraseña de Aplicación</label>
                        <input type="password" id="bsky-app-password" placeholder="xxxx-xxxx-xxxx-xxxx" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-link"></i> Conectar Cuenta</button>
                </form>
            </div>

            <div class="troubleshooting-note">
                <p><strong>¿Problemas para conectar?</strong> Si recibes un error de "credenciales inválidas" a pesar de que son correctas, te recomendamos seguir estos pasos en Bluesky: <strong>1. Reinicia tu contraseña principal. 2. Genera una nueva Contraseña de Aplicación.</strong> Esto suele solucionar el problema.</p>
            </div>
            </div>
    </template>
    
    <nav class="mobile-nav">
        <a href="/" class="mobile-nav__link active" aria-label="Inicio"><i class="fa-solid fa-house"></i></a>
        <a href="https://eptnews.substack.com/" class="mobile-nav__link" aria-label="Newsletter"><i class="fa-solid fa-newspaper"></i></a>
        <a href="#" class="mobile-nav__link" aria-label="Explorar"><i class="fa-solid fa-search"></i></a>
        <a href="/live.html" class="mobile-nav__link" id="nav-live-mobile" aria-label="En Vivo"><i class="fa-solid fa-satellite-dish"></i></a>
        <button class="mobile-nav__link" id="mobile-more-btn" aria-label="Más opciones"><i class="fa-solid fa-bars"></i></button>
    </nav>

    <div class="mobile-more-menu" id="mobile-more-menu">
        <div class="mobile-more-menu__content">
            <a href="#" data-provider="google" id="login-google-btn-mobile" class="mobile-more-menu__item login-provider-btn"><i class="fa-brands fa-google"></i><span>Iniciar con Google</span></a>
            <a href="#" data-provider="github" id="login-github-btn-mobile" class="mobile-more-menu__item login-provider-btn"><i class="fa-brands fa-github"></i><span>Iniciar con GitHub</span></a>
            <a href="#" class="mobile-more-menu__item is-disabled"><i class="fa-brands fa-orcid"></i><span>ORCID (Próximamente)</span></a>
            <hr>
            <a href="https://substack.com/chat/2867518" class="mobile-more-menu__item"><i class="fa-solid fa-message"></i><span>Comunidad</span></a>
            <a href="/live.html#seccion-eventos" class="mobile-more-menu__item"><i class="fa-solid fa-calendar-days"></i><span>Eventos</span></a>
            <hr>
            <button class="mobile-more-menu__item" id="theme-switcher-mobile"><i class="fa-solid fa-moon"></i><span>Cambiar Tema</span></button>
            <button class="mobile-more-menu__item" id="mobile-more-menu-close"><i class="fa-solid fa-xmark"></i><span>Cerrar</span></button>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>

    <footer class="site-footer">
        <div class="container footer-content">
            <div class="footer-column">
                <p class="footer-logo-text">Epistecnología</p>
                <p>&copy; 2025 Todos los derechos reservados.</p>
            </div>
            <div class="footer-column">
                <h4 class="footer-heading">Propiedad Intelectual</h4>
                <div class="footer-badges">
                    <a href="https://doi.org/10.5281/zenodo.16403615" target="_blank" rel="noopener noreferrer" title="DOI de la Plataforma">
                        <img src="https://zenodo.org/badge/DOI/10.5281/zenodo.16403615.svg" alt="DOI">
                    </a>
                    <a href="https://orcid.org/0009-0008-3022-5207" class="footer-link" target="_blank" rel="noopener noreferrer" title="Perfil ORCID">
                        <i class="fa-brands fa-orcid"></i> 0009-0008-3022-5207
                    </a>
                </div>
            </div>
            <div class="footer-column">
                <h4 class="footer-heading">Contacto</h4>
                <a href="mailto:hmarquez@epistecnologia.com" class="footer-link">
                    <i class="fa-solid fa-envelope"></i> hmarquez@epistecnologia.com
                </a>
            </div>
        </div>
    </footer>
    
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/688ee471171f1719311e6fde/1j1n2onlt';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/main.js"></script>
    <script type="module" src="/inv/js/profile.js"></script>

</body>
</html>