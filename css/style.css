/* ==========================================================================
   1. CONFIGURACIÓN GLOBAL Y VARIABLES
   ========================================================================== */

/* :root nos permite declarar "variables CSS". Es una práctica excelente para
   mantener la consistencia en colores, fuentes, etc., y facilita enormemente
   la implementación de temas, como el modo oscuro. */
:root {
    --color-background: #f0f2f5;
    --color-surface: #ffffff;
    --color-text-primary: #1c1e21;
    --color-text-secondary: #65676b;
    --color-accent: #b72a1e;
    --color-border: #ddd;
    --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.1);
    --border-radius: 12px;
}

/* Cuando el <body> tiene la clase 'dark-theme', estas variables sobreescriben
   las declaradas en :root, cambiando la paleta de colores de todo el sitio. */
body.dark-theme {
    --color-background: #18191a;
    --color-surface: #242526;
    --color-text-primary: #e4e6eb;
    --color-text-secondary: #b0b3b8;
    --color-border: #3a3b3c;
    --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Reseteo de estilos universal. Una de las reglas más importantes en cualquier CSS.
   Elimina los márgenes y paddings por defecto de los navegadores.
   'box-sizing: border-box;' hace que el padding y el borde se incluyan en el
   ancho/alto total del elemento, simplificando enormemente los cálculos de tamaño. */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* Estilos base para la etiqueta <body>, que afecta a toda la página. */
body {
    font-family: 'Inter', sans-serif;
    background-color: var(--color-background);
    color: var(--color-text-primary);
    line-height: 1.6; /* Espaciado entre líneas para mejor legibilidad. */
    transition: background-color 0.3s, color 0.3s; /* Transición suave para el cambio de tema. */
}


/* ==========================================================================
   2. LAYOUT Y UTILIDADES
   ========================================================================== */

/* Contenedor principal que limita el ancho del contenido y lo centra. */
.container {
    max-width: 1400px;
    margin: 0 auto; /* El truco para centrar un bloque horizontalmente. */
    padding: 0 2rem;
}

/* Estilos base para enlaces, botones, etc. */
a {
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover,
a.active {
    color: var(--color-accent);
}

ul {
    list-style: none; /* Elimina los puntos de las listas. */
}

button {
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit; /* Hereda la fuente del resto de la página. */
}


/* ==========================================================================
   3. COMPONENTES
   ========================================================================== */

/* --- 3.1 NAVEGACIÓN SUPERIOR (ESCRITORIO) --- */
.desktop-nav {
    padding: 1rem 0;
    position: sticky; /* Hace que el menú se quede fijo en la parte superior al hacer scroll. */
    top: 0;
    z-index: 1000; /* Asegura que la navegación esté por encima de otros contenidos. */
    -webkit-backdrop-filter: blur(10px); /* Efecto "cristal esmerilado" para Safari. */
    backdrop-filter: blur(10px); /* Efecto "cristal esmerilado" estándar. */
    background-color: rgba(240, 242, 245, 0.8); /* Color de fondo semitransparente. */
    transition: background-color 0.3s;
}

body.dark-theme .desktop-nav {
    background-color: rgba(24, 25, 26, 0.8);
}

.desktop-nav .container {
    display: flex; /* Activa Flexbox para alinear los elementos hijos. */
    justify-content: space-between; /* Distribuye los elementos horizontalmente. */
    align-items: center; /* Centra los elementos verticalmente. */
    gap: 1rem; /* Espacio entre los elementos. */
}

.desktop-nav .logo img {
    height: 40px;
    display: block; /* Elimina un pequeño espacio extra que los navegadores a veces añaden a las imágenes. */
}

.bento-box-nav {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: var(--color-surface);
    padding: 0.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-light);
    transition: background-color 0.3s;
}

.main-menu {
    flex-grow: 1; /* Permite que este elemento ocupe el espacio sobrante. */
    justify-content: center; /* Centra los iconos dentro de su caja. */
}

.nav-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 8px;
    transition: background-color 0.2s ease, color 0.2s ease;
    color: var(--color-text-secondary);
}

.nav-icon:hover {
    background-color: var(--color-background);
    color: var(--color-accent);
}

.nav-icon.active {
    background-color: var(--color-accent);
    color: white;
}


/* --- 3.2 BENTO GRID Y TARJETAS --- */
.bento-grid {
    display: grid; /* Activa CSS Grid, la tecnología perfecta para este tipo de layout. */
    grid-template-columns: repeat(4, 1fr); /* Crea una grilla de 4 columnas de igual tamaño. */
    gap: 1.25rem;
    padding: 2rem 0;
}

/* Estilo base para todas las cajas/tarjetas del grid */
.bento-box {
    background-color: var(--color-surface);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-light);
    padding: 1.5rem;
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.3s;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Asegura que el contenido no se salga de los bordes redondeados. */
    position: relative; /* Necesario para posicionar el pseudo-elemento ::after. */
}

.bento-box:hover {
    transform: translateY(-5px); /* Efecto sutil de "levantarse" al pasar el ratón. */
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
}

body.dark-theme .bento-box:hover {
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
}

.post-card {
    min-height: 250px; /* Asegura que las tarjetas más pequeñas tengan una altura mínima agradable. */
}

/* Clases modificadoras para dar variedad de tamaños a las tarjetas */
.bento-box--wide { grid-column: span 2; } /* Ocupa 2 columnas de ancho. */
.bento-box--tall { grid-row: span 2; }    /* Ocupa 2 filas de alto. */
.bento-box--large { grid-column: span 2; grid-row: span 2; } /* Ocupa un bloque de 2x2. */

.welcome-module {
    grid-column: span 4;
    cursor: default; /* El cursor no cambia porque no es un elemento cliqueable. */
}
.welcome-module:hover {
    transform: none; /* Se anula el efecto hover de las demás cajas. */
    box-shadow: var(--shadow-light);
}

/* Estilos para tarjetas con imagen de fondo */
.featured-post, .post-card {
    background-size: cover; /* La imagen cubre toda la tarjeta sin deformarse. */
    background-position: center;
}

/* El pseudo-elemento ::after se usa para crear una capa de gradiente oscuro sobre las imágenes de fondo.
   Esto asegura que el texto blanco encima sea siempre legible. */
.featured-post::after, .post-card::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.1));
    opacity: 0; /* Inicialmente es invisible. */
    transition: opacity 0.3s;
}

/* Cuando una caja tiene una imagen de fondo (añadida con 'style' por JS), hacemos visible el gradiente. */
.bento-box[style*="background-image"]::after {
    opacity: 1;
}

/* Y forzamos a que todo el texto dentro de ella sea blanco. */
.bento-box[style*="background-image"] * {
    color: white;
}

/* Contenido de las tarjetas */
.card-content {
    flex-grow: 1; /* Permite que este contenedor ocupe el espacio vertical disponible. */
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 2; /* Se asegura que el contenido esté por encima del gradiente ::after. */
    justify-content: flex-end; /* Alinea el contenido en la parte inferior de la tarjeta. */
}

.card-content h4 {
    margin-top: auto; /* Truco para que el título se separe de la categoría. */
}

.card-category {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--color-accent); /* Por defecto es rojo, pero la regla anterior lo hace blanco si hay imagen. */
    margin-bottom: 0.5rem;
}

/* Mensajes de Carga y Error */
.loading, .error {
    grid-column: span 4;
    text-align: center;
    padding: 4rem;
    font-size: 1.2rem;
    color: var(--color-text-secondary);
}


/* --- 3.3 PANEL LATERAL --- */
.side-panel {
    position: fixed; top: 0; right: 0;
    width: 100%; max-width: 650px; height: 100%;
    background-color: var(--color-surface);
    z-index: 1002;
    /* La magia de la animación: por defecto está fuera de la pantalla. */
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Transición suave. */
    border-top-left-radius: var(--border-radius);
    border-bottom-left-radius: var(--border-radius);
    box-shadow: -5px 0 15px rgba(0,0,0,0.1);
    display: flex; flex-direction: column;
}

/* Cuando el panel tiene la clase 'is-open', se mueve a su posición visible. */
.side-panel.is-open {
    transform: translateX(0);
}

.side-panel__close {
    position: absolute;
    top: 1rem; right: 1.5rem;
    color: var(--color-text-primary);
    z-index: 10;
}

.side-panel__content {
    padding: 2.5rem;
    padding-top: 4rem; /* Más espacio arriba para que el contenido no choque con el botón de cerrar. */
    overflow-y: auto; /* Permite scroll si el contenido es muy largo. */
    flex-grow: 1;
}

.side-panel__content h2 { font-size: 2rem; margin-bottom: 1rem; color: var(--color-text-primary); }
.side-panel__content .post-meta { font-size: 0.9rem; color: var(--color-text-secondary); margin-bottom: 1.5rem; }
.side-panel__content .post-body { line-height: 1.7; }
.side-panel__content .post-body img { max-width: 100%; height: auto; border-radius: 8px; }
.side-panel__content audio { width: 100%; margin-top: 1rem; }

/* Sección de compartir */
.side-panel__share {
    padding: 1rem 2.5rem;
    border-top: 1px solid var(--color-border);
    background-color: var(--color-surface);
    flex-shrink: 0; /* Evita que este contenedor se encoja. */
    display: flex;
    gap: 0.75rem;
    border-bottom-left-radius: var(--border-radius);
}

.share-btn {
    width: 44px; height: 44px;
    border-radius: 50%; /* Estilo circular. */
    border: 1px solid var(--color-border);
    color: var(--color-text-secondary);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s ease;
}

.share-btn:hover {
    background-color: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
}

/* Capa de fondo oscura */
.overlay {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1001;
    opacity: 0; /* Por defecto invisible. */
    visibility: hidden;
    transition: opacity 0.4s, visibility 0.4s;
}

.overlay.is-open {
    opacity: 1;
    visibility: visible;
}


/* --- 3.4 NAVEGACIÓN INFERIOR (MÓVIL) --- */
.mobile-nav {
    display: none; /* Oculta por defecto en escritorio. */
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    background-color: var(--color-surface);
    border-top: 1px solid var(--color-border);
    z-index: 1000;
    justify-content: space-around;
    padding: 0.5rem 0;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
}
.mobile-nav__link { display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; padding: 0.25rem 0; }
.mobile-nav__link.active { color: var(--color-accent); }
.mobile-nav__text { font-size: 0.7rem; margin-top: 2px; }


/* ==========================================================================
   4. REGLAS RESPONSIVAS (@MEDIA QUERIES)
   ========================================================================== */

/* Estilos para pantallas de tablet (hasta 992px de ancho) */
@media (max-width: 992px) {
    .bento-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .welcome-module, .collaborators-module, .bento-box--wide {
        grid-column: span 2;
    }
}

/* Estilos para pantallas de móvil (hasta 768px de ancho) */
@media (max-width: 768px) {
    .container {
        padding: 0 1rem;
    }
    .desktop-nav {
        display: none; /* Oculta la navegación de escritorio. */
    }
    .mobile-nav {
        display: flex !important; /* Muestra la navegación móvil. El '!important' asegura que esta regla gane cualquier conflicto. */
    }
    body {
        padding-bottom: 80px; /* Añade espacio al final para que la nav no tape contenido. */
    }
    .side-panel {
        max-width: 90%;
    }
    .bento-grid {
        grid-template-columns: 1fr; /* Apila todo en una sola columna. */
    }
    /* Fuerza a TODOS los módulos a ocupar 1 columna y tener un aspecto 4:3 en móvil. */
    .bento-box, .welcome-module, .featured-post, .zenodo-module, .post-card, .collaborators-module,
    .bento-box--wide, .bento-box--tall, .bento-box--large {
        grid-column: span 1 !important;
        grid-row: span 1 !important;
        aspect-ratio: 4 / 3; /* Mantiene una proporción visualmente agradable. */
        min-height: unset; /* Anula la altura mínima de escritorio. */
    }
    .bento-box[style*="background-image"] {
        justify-content: flex-end; /* Alinea el contenido abajo en las tarjetas con imagen. */
    }
}